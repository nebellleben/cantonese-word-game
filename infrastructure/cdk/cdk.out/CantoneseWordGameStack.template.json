{
 "Description": "Infrastructure for Cantonese Word Game application",
 "Resources": {
  "VPCB9E5F0B4": {
   "Type": "AWS::EC2::VPC",
   "Properties": {
    "CidrBlock": "10.0.0.0/16",
    "EnableDnsHostnames": true,
    "EnableDnsSupport": true,
    "InstanceTenancy": "default",
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/Resource"
   }
  },
  "VPCPublicSubnet1SubnetB4246D30": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.0.0/24",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/Subnet"
   }
  },
  "VPCPublicSubnet1RouteTableFEE4B781": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/RouteTable"
   }
  },
  "VPCPublicSubnet1RouteTableAssociation0B0896DC": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VPCPublicSubnet1RouteTableFEE4B781"
    },
    "SubnetId": {
     "Ref": "VPCPublicSubnet1SubnetB4246D30"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/RouteTableAssociation"
   }
  },
  "VPCPublicSubnet1DefaultRoute91CEF279": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VPCIGWB7E252D3"
    },
    "RouteTableId": {
     "Ref": "VPCPublicSubnet1RouteTableFEE4B781"
    }
   },
   "DependsOn": [
    "VPCVPCGW99B986DC"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/DefaultRoute"
   }
  },
  "VPCPublicSubnet1EIP6AD938E8": {
   "Type": "AWS::EC2::EIP",
   "Properties": {
    "Domain": "vpc",
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet1"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/EIP"
   }
  },
  "VPCPublicSubnet1NATGatewayE0556630": {
   "Type": "AWS::EC2::NatGateway",
   "Properties": {
    "AllocationId": {
     "Fn::GetAtt": [
      "VPCPublicSubnet1EIP6AD938E8",
      "AllocationId"
     ]
    },
    "SubnetId": {
     "Ref": "VPCPublicSubnet1SubnetB4246D30"
    },
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet1"
     }
    ]
   },
   "DependsOn": [
    "VPCPublicSubnet1DefaultRoute91CEF279",
    "VPCPublicSubnet1RouteTableAssociation0B0896DC"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet1/NATGateway"
   }
  },
  "VPCPublicSubnet2Subnet74179F39": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.1.0/24",
    "MapPublicIpOnLaunch": true,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Public"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Public"
     },
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet2/Subnet"
   }
  },
  "VPCPublicSubnet2RouteTable6F1A15F1": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PublicSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet2/RouteTable"
   }
  },
  "VPCPublicSubnet2RouteTableAssociation5A808732": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VPCPublicSubnet2RouteTable6F1A15F1"
    },
    "SubnetId": {
     "Ref": "VPCPublicSubnet2Subnet74179F39"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet2/RouteTableAssociation"
   }
  },
  "VPCPublicSubnet2DefaultRouteB7481BBA": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "GatewayId": {
     "Ref": "VPCIGWB7E252D3"
    },
    "RouteTableId": {
     "Ref": "VPCPublicSubnet2RouteTable6F1A15F1"
    }
   },
   "DependsOn": [
    "VPCVPCGW99B986DC"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PublicSubnet2/DefaultRoute"
   }
  },
  "VPCPrivateSubnet1Subnet8BCA10E0": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      0,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.2.0/24",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Private"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Private"
     },
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PrivateSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet1/Subnet"
   }
  },
  "VPCPrivateSubnet1RouteTableBE8A6027": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PrivateSubnet1"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet1/RouteTable"
   }
  },
  "VPCPrivateSubnet1RouteTableAssociation347902D1": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VPCPrivateSubnet1RouteTableBE8A6027"
    },
    "SubnetId": {
     "Ref": "VPCPrivateSubnet1Subnet8BCA10E0"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet1/RouteTableAssociation"
   }
  },
  "VPCPrivateSubnet1DefaultRouteAE1D6490": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "NatGatewayId": {
     "Ref": "VPCPublicSubnet1NATGatewayE0556630"
    },
    "RouteTableId": {
     "Ref": "VPCPrivateSubnet1RouteTableBE8A6027"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet1/DefaultRoute"
   }
  },
  "VPCPrivateSubnet2SubnetCFCDAA7A": {
   "Type": "AWS::EC2::Subnet",
   "Properties": {
    "AvailabilityZone": {
     "Fn::Select": [
      1,
      {
       "Fn::GetAZs": ""
      }
     ]
    },
    "CidrBlock": "10.0.3.0/24",
    "MapPublicIpOnLaunch": false,
    "Tags": [
     {
      "Key": "aws-cdk:subnet-name",
      "Value": "Private"
     },
     {
      "Key": "aws-cdk:subnet-type",
      "Value": "Private"
     },
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PrivateSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet2/Subnet"
   }
  },
  "VPCPrivateSubnet2RouteTable0A19E10E": {
   "Type": "AWS::EC2::RouteTable",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC/PrivateSubnet2"
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet2/RouteTable"
   }
  },
  "VPCPrivateSubnet2RouteTableAssociation0C73D413": {
   "Type": "AWS::EC2::SubnetRouteTableAssociation",
   "Properties": {
    "RouteTableId": {
     "Ref": "VPCPrivateSubnet2RouteTable0A19E10E"
    },
    "SubnetId": {
     "Ref": "VPCPrivateSubnet2SubnetCFCDAA7A"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet2/RouteTableAssociation"
   }
  },
  "VPCPrivateSubnet2DefaultRouteF4F5CFD2": {
   "Type": "AWS::EC2::Route",
   "Properties": {
    "DestinationCidrBlock": "0.0.0.0/0",
    "NatGatewayId": {
     "Ref": "VPCPublicSubnet1NATGatewayE0556630"
    },
    "RouteTableId": {
     "Ref": "VPCPrivateSubnet2RouteTable0A19E10E"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/PrivateSubnet2/DefaultRoute"
   }
  },
  "VPCIGWB7E252D3": {
   "Type": "AWS::EC2::InternetGateway",
   "Properties": {
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/VPC"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/IGW"
   }
  },
  "VPCVPCGW99B986DC": {
   "Type": "AWS::EC2::VPCGatewayAttachment",
   "Properties": {
    "InternetGatewayId": {
     "Ref": "VPCIGWB7E252D3"
    },
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/VPC/VPCGW"
   }
  },
  "AppSecretsA1997F2A": {
   "Type": "AWS::SecretsManager::Secret",
   "Properties": {
    "Description": "Secrets for Cantonese Word Game application",
    "GenerateSecretString": {
     "ExcludeCharacters": "\"@/\\",
     "GenerateStringKey": "SECRET_KEY",
     "SecretStringTemplate": "{\"SECRET_KEY\":\"\"}"
    },
    "Name": "cantonese-word-game-secrets"
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/AppSecrets/Resource"
   }
  },
  "DBSubnetGroup": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Subnet group for RDS PostgreSQL",
    "DBSubnetGroupName": "cantonese-db-subnet-group",
    "SubnetIds": [
     {
      "Ref": "VPCPrivateSubnet1Subnet8BCA10E0"
     },
     {
      "Ref": "VPCPrivateSubnet2SubnetCFCDAA7A"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/DBSubnetGroup/Default"
   }
  },
  "DBSecurityGroupE3B245A3": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for RDS PostgreSQL",
    "SecurityGroupEgress": [
     {
      "CidrIp": "255.255.255.255/32",
      "Description": "Disallow all traffic",
      "FromPort": 252,
      "IpProtocol": "icmp",
      "ToPort": 86
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/DBSecurityGroup/Resource"
   }
  },
  "DBSecurityGroupfromCantoneseWordGameStackBackendSecurityGroupBAEE9094543245880A39": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Allow backend to access RDS",
    "FromPort": 5432,
    "GroupId": {
     "Fn::GetAtt": [
      "DBSecurityGroupE3B245A3",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "BackendSecurityGroup96CF32F1",
      "GroupId"
     ]
    },
    "ToPort": 5432
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/DBSecurityGroup/from CantoneseWordGameStackBackendSecurityGroupBAEE9094:5432"
   }
  },
  "CantoneseWordGameStackPostgreSQLInstanceSecret3256ACFC8ee0a797cad8a68dbeb85f8698cdb5bb": {
   "Type": "AWS::SecretsManager::Secret",
   "Properties": {
    "Description": {
     "Fn::Join": [
      "",
      [
       "Generated by the CDK for stack: ",
       {
        "Ref": "AWS::StackName"
       }
      ]
     ]
    },
    "GenerateSecretString": {
     "ExcludeCharacters": "\"@/\\",
     "GenerateStringKey": "password",
     "PasswordLength": 30,
     "SecretStringTemplate": "{\"username\":\"postgres_admin\"}"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/PostgreSQLInstance/Secret/Resource"
   }
  },
  "PostgreSQLInstanceSecretAttachmentF29BC406": {
   "Type": "AWS::SecretsManager::SecretTargetAttachment",
   "Properties": {
    "SecretId": {
     "Ref": "CantoneseWordGameStackPostgreSQLInstanceSecret3256ACFC8ee0a797cad8a68dbeb85f8698cdb5bb"
    },
    "TargetId": {
     "Ref": "PostgreSQLInstanceD9AD3CF0"
    },
    "TargetType": "AWS::RDS::DBInstance"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/PostgreSQLInstance/Secret/Attachment/Resource"
   }
  },
  "PostgreSQLInstanceD9AD3CF0": {
   "Type": "AWS::RDS::DBInstance",
   "Properties": {
    "AllocatedStorage": "20",
    "BackupRetentionPeriod": 1,
    "CopyTagsToSnapshot": true,
    "DBInstanceClass": "db.t3.micro",
    "DBName": "cantonese_game",
    "DBSubnetGroupName": {
     "Ref": "DBSubnetGroup"
    },
    "DeletionProtection": false,
    "Engine": "postgres",
    "EngineVersion": "15",
    "MasterUserPassword": {
     "Fn::Join": [
      "",
      [
       "{{resolve:secretsmanager:",
       {
        "Ref": "CantoneseWordGameStackPostgreSQLInstanceSecret3256ACFC8ee0a797cad8a68dbeb85f8698cdb5bb"
       },
       ":SecretString:password::}}"
      ]
     ]
    },
    "MasterUsername": "postgres_admin",
    "MaxAllocatedStorage": 100,
    "MultiAZ": false,
    "StorageType": "gp2",
    "VPCSecurityGroups": [
     {
      "Fn::GetAtt": [
       "DBSecurityGroupE3B245A3",
       "GroupId"
      ]
     }
    ]
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/PostgreSQLInstance/Resource"
   }
  },
  "ClusterEB0386A7": {
   "Type": "AWS::ECS::Cluster",
   "Properties": {
    "ClusterName": "cantonese-word-game-cluster"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/Cluster/Resource"
   }
  },
  "TaskExecutionRole250D2532": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/TaskExecutionRole/Resource"
   }
  },
  "TaskExecutionRoleDefaultPolicyA84DD1B0": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Ref": "AppSecretsA1997F2A"
        },
        {
         "Ref": "PostgreSQLInstanceSecretAttachmentF29BC406"
        }
       ]
      },
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:BatchGetImage",
        "ecr:GetDownloadUrlForLayer"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:aws:ecr:us-east-1:",
           {
            "Ref": "AWS::AccountId"
           },
           ":repository/cantonese-word-game-backend"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:aws:ecr:us-east-1:",
           {
            "Ref": "AWS::AccountId"
           },
           ":repository/cantonese-word-game-frontend"
          ]
         ]
        }
       ]
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "BackendLogGroupDA10F1B2",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "FrontendLogGroupCE4F14E0",
          "Arn"
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "TaskExecutionRoleDefaultPolicyA84DD1B0",
    "Roles": [
     {
      "Ref": "TaskExecutionRole250D2532"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/TaskExecutionRole/DefaultPolicy/Resource"
   }
  },
  "BackendTaskRole65DD5890": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendTaskRole/Resource"
   }
  },
  "BackendTaskRoleDefaultPolicyD82ED08E": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "secretsmanager:DescribeSecret",
        "secretsmanager:GetSecretValue"
       ],
       "Effect": "Allow",
       "Resource": {
        "Ref": "AppSecretsA1997F2A"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "BackendTaskRoleDefaultPolicyD82ED08E",
    "Roles": [
     {
      "Ref": "BackendTaskRole65DD5890"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendTaskRole/DefaultPolicy/Resource"
   }
  },
  "FrontendLogGroupCE4F14E0": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "LogGroupName": "/ecs/cantonese-word-game-frontend",
    "RetentionInDays": 7
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendLogGroup/Resource"
   }
  },
  "BackendLogGroupDA10F1B2": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "LogGroupName": "/ecs/cantonese-word-game-backend",
    "RetentionInDays": 7
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendLogGroup/Resource"
   }
  },
  "BackendSecurityGroup96CF32F1": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for backend service",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "SecurityGroupIngress": [
     {
      "CidrIp": {
       "Fn::GetAtt": [
        "VPCB9E5F0B4",
        "CidrBlock"
       ]
      },
      "Description": "Allow ALB to access backend",
      "FromPort": 8000,
      "IpProtocol": "tcp",
      "ToPort": 8000
     },
     {
      "CidrIp": {
       "Fn::GetAtt": [
        "VPCB9E5F0B4",
        "CidrBlock"
       ]
      },
      "Description": "Allow ALB to access backend via HTTPS",
      "FromPort": 8443,
      "IpProtocol": "tcp",
      "ToPort": 8443
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendSecurityGroup/Resource"
   }
  },
  "BackendSecurityGroupfromCantoneseWordGameStackALBSecurityGroupA716A4D98000704F281B": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Load balancer to target",
    "FromPort": 8000,
    "GroupId": {
     "Fn::GetAtt": [
      "BackendSecurityGroup96CF32F1",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "ALBSecurityGroup8B8624F8",
      "GroupId"
     ]
    },
    "ToPort": 8000
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendSecurityGroup/from CantoneseWordGameStackALBSecurityGroupA716A4D9:8000"
   }
  },
  "BackendTaskDefinitionEC224DE6": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Environment": [
       {
        "Name": "API_V1_PREFIX",
        "Value": "/api"
       },
       {
        "Name": "PROJECT_NAME",
        "Value": "Cantonese Word Game API"
       },
       {
        "Name": "ALGORITHM",
        "Value": "HS256"
       },
       {
        "Name": "ACCESS_TOKEN_EXPIRE_MINUTES",
        "Value": "1440"
       },
       {
        "Name": "CORS_ORIGINS",
        "Value": "https://app.flumenlucidum.com"
       }
      ],
      "Essential": true,
      "Image": {
       "Fn::Join": [
        "",
        [
         {
          "Ref": "AWS::AccountId"
         },
         ".dkr.ecr.us-east-1.",
         {
          "Ref": "AWS::URLSuffix"
         },
         "/cantonese-word-game-backend:latest"
        ]
       ]
      },
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "BackendLogGroupDA10F1B2"
        },
        "awslogs-stream-prefix": "backend",
        "awslogs-region": "us-east-1"
       }
      },
      "Name": "BackendContainer",
      "PortMappings": [
       {
        "ContainerPort": 8000,
        "Protocol": "tcp"
       }
      ],
      "Secrets": [
       {
        "Name": "SECRET_KEY",
        "ValueFrom": {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "AppSecretsA1997F2A"
           },
           ":SECRET_KEY::"
          ]
         ]
        }
       },
       {
        "Name": "DATABASE_URL",
        "ValueFrom": {
         "Fn::Join": [
          "",
          [
           {
            "Ref": "PostgreSQLInstanceSecretAttachmentF29BC406"
           },
           ":uri::"
          ]
         ]
        }
       }
      ]
     }
    ],
    "Cpu": "512",
    "EphemeralStorage": {
     "SizeInGiB": 30
    },
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "TaskExecutionRole250D2532",
      "Arn"
     ]
    },
    "Family": "CantoneseWordGameStackBackendTaskDefinitionF94ECCED",
    "Memory": "1024",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "BackendTaskRole65DD5890",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendTaskDefinition/Resource"
   }
  },
  "ALBAEE750D2": {
   "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
   "Properties": {
    "LoadBalancerAttributes": [
     {
      "Key": "deletion_protection.enabled",
      "Value": "false"
     }
    ],
    "Name": "cantonese-word-game-alb",
    "Scheme": "internet-facing",
    "SecurityGroups": [
     {
      "Fn::GetAtt": [
       "ALBSecurityGroup8B8624F8",
       "GroupId"
      ]
     }
    ],
    "Subnets": [
     {
      "Ref": "VPCPublicSubnet1SubnetB4246D30"
     },
     {
      "Ref": "VPCPublicSubnet2Subnet74179F39"
     }
    ],
    "Type": "application"
   },
   "DependsOn": [
    "VPCPublicSubnet1DefaultRoute91CEF279",
    "VPCPublicSubnet1RouteTableAssociation0B0896DC",
    "VPCPublicSubnet2DefaultRouteB7481BBA",
    "VPCPublicSubnet2RouteTableAssociation5A808732"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/Resource"
   }
  },
  "ALBSecurityGroup8B8624F8": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Automatically created Security Group for ELB CantoneseWordGameStackALB266EF23E",
    "SecurityGroupIngress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow from anyone on port 443",
      "FromPort": 443,
      "IpProtocol": "tcp",
      "ToPort": 443
     },
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow from anyone on port 80",
      "FromPort": 80,
      "IpProtocol": "tcp",
      "ToPort": 80
     },
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow from anyone on port 8443",
      "FromPort": 8443,
      "IpProtocol": "tcp",
      "ToPort": 8443
     },
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow from anyone on port 8000",
      "FromPort": 8000,
      "IpProtocol": "tcp",
      "ToPort": 8000
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/SecurityGroup/Resource"
   }
  },
  "ALBSecurityGrouptoCantoneseWordGameStackBackendSecurityGroupBAEE909480006756ADA5": {
   "Type": "AWS::EC2::SecurityGroupEgress",
   "Properties": {
    "Description": "Load balancer to target",
    "DestinationSecurityGroupId": {
     "Fn::GetAtt": [
      "BackendSecurityGroup96CF32F1",
      "GroupId"
     ]
    },
    "FromPort": 8000,
    "GroupId": {
     "Fn::GetAtt": [
      "ALBSecurityGroup8B8624F8",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "ToPort": 8000
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/SecurityGroup/to CantoneseWordGameStackBackendSecurityGroupBAEE9094:8000"
   }
  },
  "ALBSecurityGrouptoCantoneseWordGameStackFrontendSecurityGroup9F43FBD48021BAC850": {
   "Type": "AWS::EC2::SecurityGroupEgress",
   "Properties": {
    "Description": "Load balancer to target",
    "DestinationSecurityGroupId": {
     "Fn::GetAtt": [
      "FrontendSecurityGroup69AD9D5B",
      "GroupId"
     ]
    },
    "FromPort": 80,
    "GroupId": {
     "Fn::GetAtt": [
      "ALBSecurityGroup8B8624F8",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "ToPort": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/SecurityGroup/to CantoneseWordGameStackFrontendSecurityGroup9F43FBD4:80"
   }
  },
  "ALBFrontendHTTPSListener23DCBED5": {
   "Type": "AWS::ElasticLoadBalancingV2::Listener",
   "Properties": {
    "Certificates": [
     {
      "CertificateArn": {
       "Ref": "Certificate4E7ABB08"
      }
     }
    ],
    "DefaultActions": [
     {
      "TargetGroupArn": {
       "Ref": "FrontendTargetGroupED7B3E5D"
      },
      "Type": "forward"
     }
    ],
    "LoadBalancerArn": {
     "Ref": "ALBAEE750D2"
    },
    "Port": 443,
    "Protocol": "HTTPS",
    "SslPolicy": "ELBSecurityPolicy-2016-08"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/FrontendHTTPSListener/Resource"
   }
  },
  "ALBFrontendHTTPListener48E64C12": {
   "Type": "AWS::ElasticLoadBalancingV2::Listener",
   "Properties": {
    "DefaultActions": [
     {
      "RedirectConfig": {
       "Port": "443",
       "Protocol": "HTTPS",
       "StatusCode": "HTTP_301"
      },
      "Type": "redirect"
     }
    ],
    "LoadBalancerArn": {
     "Ref": "ALBAEE750D2"
    },
    "Port": 80,
    "Protocol": "HTTP"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/FrontendHTTPListener/Resource"
   }
  },
  "ALBBackendHTTPSListener37AAB8F4": {
   "Type": "AWS::ElasticLoadBalancingV2::Listener",
   "Properties": {
    "Certificates": [
     {
      "CertificateArn": {
       "Ref": "Certificate4E7ABB08"
      }
     }
    ],
    "DefaultActions": [
     {
      "TargetGroupArn": {
       "Ref": "BackendTargetGroupECF98930"
      },
      "Type": "forward"
     }
    ],
    "LoadBalancerArn": {
     "Ref": "ALBAEE750D2"
    },
    "Port": 8443,
    "Protocol": "HTTPS",
    "SslPolicy": "ELBSecurityPolicy-2016-08"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/BackendHTTPSListener/Resource"
   }
  },
  "ALBBackendHTTPListenerF6AE6F17": {
   "Type": "AWS::ElasticLoadBalancingV2::Listener",
   "Properties": {
    "DefaultActions": [
     {
      "RedirectConfig": {
       "Port": "8443",
       "Protocol": "HTTPS",
       "StatusCode": "HTTP_301"
      },
      "Type": "redirect"
     }
    ],
    "LoadBalancerArn": {
     "Ref": "ALBAEE750D2"
    },
    "Port": 8000,
    "Protocol": "HTTP"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALB/BackendHTTPListener/Resource"
   }
  },
  "ALBDNSParameter52ABC8D3": {
   "Type": "AWS::SSM::Parameter",
   "Properties": {
    "Description": "ALB DNS name for Cantonese Word Game",
    "Name": "/cantonese-word-game/alb-dns",
    "Type": "String",
    "Value": {
     "Fn::GetAtt": [
      "ALBAEE750D2",
      "DNSName"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/ALBDNSParameter/Resource"
   }
  },
  "HostedZoneDB99F866": {
   "Type": "AWS::Route53::HostedZone",
   "Properties": {
    "HostedZoneConfig": {
     "Comment": "Hosted zone for flumenlucidum.com"
    },
    "Name": "flumenlucidum.com."
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/HostedZone/Resource"
   }
  },
  "AppARecord4FBFEDE4": {
   "Type": "AWS::Route53::RecordSet",
   "Properties": {
    "AliasTarget": {
     "DNSName": {
      "Fn::Join": [
       "",
       [
        "dualstack.",
        {
         "Fn::GetAtt": [
          "ALBAEE750D2",
          "DNSName"
         ]
        }
       ]
      ]
     },
     "HostedZoneId": {
      "Fn::GetAtt": [
       "ALBAEE750D2",
       "CanonicalHostedZoneID"
      ]
     }
    },
    "HostedZoneId": {
     "Ref": "HostedZoneDB99F866"
    },
    "Name": "app.flumenlucidum.com.",
    "Type": "A"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/AppARecord/Resource"
   }
  },
  "Certificate4E7ABB08": {
   "Type": "AWS::CertificateManager::Certificate",
   "Properties": {
    "DomainName": "app.flumenlucidum.com",
    "DomainValidationOptions": [
     {
      "DomainName": "app.flumenlucidum.com",
      "HostedZoneId": {
       "Ref": "HostedZoneDB99F866"
      }
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "CantoneseWordGameStack/Certificate"
     }
    ],
    "ValidationMethod": "DNS"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/Certificate/Resource"
   }
  },
  "FrontendSecurityGroup69AD9D5B": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Security group for frontend service",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "SecurityGroupIngress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow internet to access frontend",
      "FromPort": 80,
      "IpProtocol": "tcp",
      "ToPort": 80
     },
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow HTTPS access from internet",
      "FromPort": 443,
      "IpProtocol": "tcp",
      "ToPort": 443
     },
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow HTTPS backend access from internet",
      "FromPort": 8443,
      "IpProtocol": "tcp",
      "ToPort": 8443
     }
    ],
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendSecurityGroup/Resource"
   }
  },
  "FrontendSecurityGroupfromCantoneseWordGameStackALBSecurityGroupA716A4D9801E1135E4": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Load balancer to target",
    "FromPort": 80,
    "GroupId": {
     "Fn::GetAtt": [
      "FrontendSecurityGroup69AD9D5B",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "ALBSecurityGroup8B8624F8",
      "GroupId"
     ]
    },
    "ToPort": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendSecurityGroup/from CantoneseWordGameStackALBSecurityGroupA716A4D9:80"
   }
  },
  "FrontendTaskDefinitionTaskRole0DD17CB3": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendTaskDefinition/TaskRole/Resource"
   }
  },
  "FrontendTaskDefinition6CBC2B00": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Environment": [
       {
        "Name": "VITE_API_BASE_URL",
        "Value": "https://app.flumenlucidum.com:8443/api"
       }
      ],
      "Essential": true,
      "Image": {
       "Fn::Join": [
        "",
        [
         {
          "Ref": "AWS::AccountId"
         },
         ".dkr.ecr.us-east-1.",
         {
          "Ref": "AWS::URLSuffix"
         },
         "/cantonese-word-game-frontend:latest"
        ]
       ]
      },
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "FrontendLogGroupCE4F14E0"
        },
        "awslogs-stream-prefix": "frontend",
        "awslogs-region": "us-east-1"
       }
      },
      "Name": "FrontendContainer",
      "PortMappings": [
       {
        "ContainerPort": 80,
        "Protocol": "tcp"
       }
      ]
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "TaskExecutionRole250D2532",
      "Arn"
     ]
    },
    "Family": "CantoneseWordGameStackFrontendTaskDefinition1358A764",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "FrontendTaskDefinitionTaskRole0DD17CB3",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendTaskDefinition/Resource"
   }
  },
  "BackendTargetGroupECF98930": {
   "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
   "Properties": {
    "HealthCheckIntervalSeconds": 30,
    "HealthCheckPath": "/health",
    "HealthCheckTimeoutSeconds": 5,
    "HealthyThresholdCount": 2,
    "Port": 8000,
    "Protocol": "HTTP",
    "TargetGroupAttributes": [
     {
      "Key": "stickiness.enabled",
      "Value": "false"
     }
    ],
    "TargetType": "ip",
    "UnhealthyThresholdCount": 3,
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendTargetGroup/Resource"
   }
  },
  "FrontendTargetGroupED7B3E5D": {
   "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
   "Properties": {
    "HealthCheckIntervalSeconds": 30,
    "HealthCheckPath": "/health",
    "HealthCheckTimeoutSeconds": 5,
    "HealthyThresholdCount": 2,
    "Port": 80,
    "Protocol": "HTTP",
    "TargetGroupAttributes": [
     {
      "Key": "stickiness.enabled",
      "Value": "false"
     }
    ],
    "TargetType": "ip",
    "UnhealthyThresholdCount": 3,
    "VpcId": {
     "Ref": "VPCB9E5F0B4"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendTargetGroup/Resource"
   }
  },
  "BackendService7A4224EE": {
   "Type": "AWS::ECS::Service",
   "Properties": {
    "Cluster": {
     "Ref": "ClusterEB0386A7"
    },
    "DeploymentConfiguration": {
     "MaximumPercent": 200,
     "MinimumHealthyPercent": 50
    },
    "DesiredCount": 1,
    "EnableECSManagedTags": false,
    "HealthCheckGracePeriodSeconds": 120,
    "LaunchType": "FARGATE",
    "LoadBalancers": [
     {
      "ContainerName": "BackendContainer",
      "ContainerPort": 8000,
      "TargetGroupArn": {
       "Ref": "BackendTargetGroupECF98930"
      }
     }
    ],
    "NetworkConfiguration": {
     "AwsvpcConfiguration": {
      "AssignPublicIp": "DISABLED",
      "SecurityGroups": [
       {
        "Fn::GetAtt": [
         "BackendSecurityGroup96CF32F1",
         "GroupId"
        ]
       }
      ],
      "Subnets": [
       {
        "Ref": "VPCPrivateSubnet1Subnet8BCA10E0"
       },
       {
        "Ref": "VPCPrivateSubnet2SubnetCFCDAA7A"
       }
      ]
     }
    },
    "ServiceName": "cantonese-word-game-backend-service",
    "TaskDefinition": {
     "Ref": "BackendTaskDefinitionEC224DE6"
    }
   },
   "DependsOn": [
    "ALBBackendHTTPSListener37AAB8F4",
    "BackendTaskRoleDefaultPolicyD82ED08E",
    "BackendTaskRole65DD5890"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendService/Service"
   }
  },
  "FrontendServiceBC94BA93": {
   "Type": "AWS::ECS::Service",
   "Properties": {
    "Cluster": {
     "Ref": "ClusterEB0386A7"
    },
    "DeploymentConfiguration": {
     "MaximumPercent": 200,
     "MinimumHealthyPercent": 50
    },
    "DesiredCount": 1,
    "EnableECSManagedTags": false,
    "HealthCheckGracePeriodSeconds": 90,
    "LaunchType": "FARGATE",
    "LoadBalancers": [
     {
      "ContainerName": "FrontendContainer",
      "ContainerPort": 80,
      "TargetGroupArn": {
       "Ref": "FrontendTargetGroupED7B3E5D"
      }
     }
    ],
    "NetworkConfiguration": {
     "AwsvpcConfiguration": {
      "AssignPublicIp": "DISABLED",
      "SecurityGroups": [
       {
        "Fn::GetAtt": [
         "FrontendSecurityGroup69AD9D5B",
         "GroupId"
        ]
       }
      ],
      "Subnets": [
       {
        "Ref": "VPCPrivateSubnet1Subnet8BCA10E0"
       },
       {
        "Ref": "VPCPrivateSubnet2SubnetCFCDAA7A"
       }
      ]
     }
    },
    "ServiceName": "cantonese-word-game-frontend-service",
    "TaskDefinition": {
     "Ref": "FrontendTaskDefinition6CBC2B00"
    }
   },
   "DependsOn": [
    "ALBFrontendHTTPSListener23DCBED5",
    "FrontendTaskDefinitionTaskRole0DD17CB3"
   ],
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendService/Service"
   }
  },
  "BackendCPUAlarmD304B129": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when backend CPU utilization exceeds 80%",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "ClusterName",
      "Value": {
       "Ref": "ClusterEB0386A7"
      }
     },
     {
      "Name": "ServiceName",
      "Value": {
       "Fn::GetAtt": [
        "BackendService7A4224EE",
        "Name"
       ]
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "CPUUtilization",
    "Namespace": "AWS/ECS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendCPUAlarm/Resource"
   }
  },
  "BackendMemoryAlarm71883CA5": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when backend memory utilization exceeds 80%",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "ClusterName",
      "Value": {
       "Ref": "ClusterEB0386A7"
      }
     },
     {
      "Name": "ServiceName",
      "Value": {
       "Fn::GetAtt": [
        "BackendService7A4224EE",
        "Name"
       ]
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "MemoryUtilization",
    "Namespace": "AWS/ECS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendMemoryAlarm/Resource"
   }
  },
  "FrontendCPUAlarm2F1C75D3": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when frontend CPU utilization exceeds 80%",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "ClusterName",
      "Value": {
       "Ref": "ClusterEB0386A7"
      }
     },
     {
      "Name": "ServiceName",
      "Value": {
       "Fn::GetAtt": [
        "FrontendServiceBC94BA93",
        "Name"
       ]
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "CPUUtilization",
    "Namespace": "AWS/ECS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendCPUAlarm/Resource"
   }
  },
  "FrontendMemoryAlarmEDA6D879": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when frontend memory utilization exceeds 80%",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "ClusterName",
      "Value": {
       "Ref": "ClusterEB0386A7"
      }
     },
     {
      "Name": "ServiceName",
      "Value": {
       "Fn::GetAtt": [
        "FrontendServiceBC94BA93",
        "Name"
       ]
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "MemoryUtilization",
    "Namespace": "AWS/ECS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendMemoryAlarm/Resource"
   }
  },
  "BackendTargetHealthAlarm1E36481B": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when backend target health is unhealthy",
    "ComparisonOperator": "LessThanThreshold",
    "Dimensions": [
     {
      "Name": "LoadBalancer",
      "Value": {
       "Fn::Join": [
        "",
        [
         {
          "Fn::Select": [
           1,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBBackendHTTPSListener37AAB8F4"
             }
            ]
           }
          ]
         },
         "/",
         {
          "Fn::Select": [
           2,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBBackendHTTPSListener37AAB8F4"
             }
            ]
           }
          ]
         },
         "/",
         {
          "Fn::Select": [
           3,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBBackendHTTPSListener37AAB8F4"
             }
            ]
           }
          ]
         }
        ]
       ]
      }
     },
     {
      "Name": "TargetGroup",
      "Value": {
       "Fn::GetAtt": [
        "BackendTargetGroupECF98930",
        "TargetGroupFullName"
       ]
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "HealthyHostCount",
    "Namespace": "AWS/ApplicationELB",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 1
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/BackendTargetHealthAlarm/Resource"
   }
  },
  "FrontendTargetHealthAlarm1B80E976": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when frontend target health is unhealthy",
    "ComparisonOperator": "LessThanThreshold",
    "Dimensions": [
     {
      "Name": "LoadBalancer",
      "Value": {
       "Fn::Join": [
        "",
        [
         {
          "Fn::Select": [
           1,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBFrontendHTTPSListener23DCBED5"
             }
            ]
           }
          ]
         },
         "/",
         {
          "Fn::Select": [
           2,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBFrontendHTTPSListener23DCBED5"
             }
            ]
           }
          ]
         },
         "/",
         {
          "Fn::Select": [
           3,
           {
            "Fn::Split": [
             "/",
             {
              "Ref": "ALBFrontendHTTPSListener23DCBED5"
             }
            ]
           }
          ]
         }
        ]
       ]
      }
     },
     {
      "Name": "TargetGroup",
      "Value": {
       "Fn::GetAtt": [
        "FrontendTargetGroupED7B3E5D",
        "TargetGroupFullName"
       ]
      }
     }
    ],
    "EvaluationPeriods": 1,
    "MetricName": "HealthyHostCount",
    "Namespace": "AWS/ApplicationELB",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 1
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/FrontendTargetHealthAlarm/Resource"
   }
  },
  "RDSCPUAlarm2A948462": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when RDS CPU utilization exceeds 80%",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "DBInstanceIdentifier",
      "Value": {
       "Ref": "PostgreSQLInstanceD9AD3CF0"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "CPUUtilization",
    "Namespace": "AWS/RDS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 80
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/RDSCPUAlarm/Resource"
   }
  },
  "RDSConnectionsAlarm2807DF7A": {
   "Type": "AWS::CloudWatch::Alarm",
   "Properties": {
    "AlarmDescription": "Alert when RDS connections exceed 50",
    "ComparisonOperator": "GreaterThanOrEqualToThreshold",
    "Dimensions": [
     {
      "Name": "DBInstanceIdentifier",
      "Value": {
       "Ref": "PostgreSQLInstanceD9AD3CF0"
      }
     }
    ],
    "EvaluationPeriods": 2,
    "MetricName": "DatabaseConnections",
    "Namespace": "AWS/RDS",
    "Period": 300,
    "Statistic": "Average",
    "Threshold": 50
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/RDSConnectionsAlarm/Resource"
   }
  },
  "MonitoringDashboard96464763": {
   "Type": "AWS::CloudWatch::Dashboard",
   "Properties": {
    "DashboardBody": {
     "Fn::Join": [
      "",
      [
       "{\"widgets\":[{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Backend CPU Utilization\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ECS\",\"CPUUtilization\",\"ClusterName\",\"",
       {
        "Ref": "ClusterEB0386A7"
       },
       "\",\"ServiceName\",\"",
       {
        "Fn::GetAtt": [
         "BackendService7A4224EE",
         "Name"
        ]
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":6,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Backend Memory Utilization\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ECS\",\"MemoryUtilization\",\"ClusterName\",\"",
       {
        "Ref": "ClusterEB0386A7"
       },
       "\",\"ServiceName\",\"",
       {
        "Fn::GetAtt": [
         "BackendService7A4224EE",
         "Name"
        ]
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":12,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Frontend CPU Utilization\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ECS\",\"CPUUtilization\",\"ClusterName\",\"",
       {
        "Ref": "ClusterEB0386A7"
       },
       "\",\"ServiceName\",\"",
       {
        "Fn::GetAtt": [
         "FrontendServiceBC94BA93",
         "Name"
        ]
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":18,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Frontend Memory Utilization\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ECS\",\"MemoryUtilization\",\"ClusterName\",\"",
       {
        "Ref": "ClusterEB0386A7"
       },
       "\",\"ServiceName\",\"",
       {
        "Fn::GetAtt": [
         "FrontendServiceBC94BA93",
         "Name"
        ]
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":0,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"RDS CPU Utilization\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/RDS\",\"CPUUtilization\",\"DBInstanceIdentifier\",\"",
       {
        "Ref": "PostgreSQLInstanceD9AD3CF0"
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":6,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"RDS Connections\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/RDS\",\"DatabaseConnections\",\"DBInstanceIdentifier\",\"",
       {
        "Ref": "PostgreSQLInstanceD9AD3CF0"
       },
       "\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":12,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"ALB Request Count\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ApplicationELB\",\"RequestCount\",\"LoadBalancer\",\"",
       {
        "Fn::GetAtt": [
         "ALBAEE750D2",
         "LoadBalancerFullName"
        ]
       },
       "\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":6,\"height\":6,\"x\":18,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"ALB Target Response Time\",\"region\":\"",
       {
        "Ref": "AWS::Region"
       },
       "\",\"metrics\":[[\"AWS/ApplicationELB\",\"TargetResponseTime\",\"LoadBalancer\",\"",
       {
        "Fn::Select": [
         1,
         {
          "Fn::Split": [
           "/",
           {
            "Ref": "ALBBackendHTTPSListener37AAB8F4"
           }
          ]
         }
        ]
       },
       "/",
       {
        "Fn::Select": [
         2,
         {
          "Fn::Split": [
           "/",
           {
            "Ref": "ALBBackendHTTPSListener37AAB8F4"
           }
          ]
         }
        ]
       },
       "/",
       {
        "Fn::Select": [
         3,
         {
          "Fn::Split": [
           "/",
           {
            "Ref": "ALBBackendHTTPSListener37AAB8F4"
           }
          ]
         }
        ]
       },
       "\",\"TargetGroup\",\"",
       {
        "Fn::GetAtt": [
         "BackendTargetGroupECF98930",
         "TargetGroupFullName"
        ]
       },
       "\"]],\"yAxis\":{}}}]}"
      ]
     ]
    },
    "DashboardName": "CantoneseWordGame-Dashboard"
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/MonitoringDashboard/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/31S227bMAz9lr4rHpp0H5BL1wUoNsMp+rCXgZYZR4stGRKVIDD876Ol+NIO2JMODyny8LJMlqun5PEBrm4hi/OiUnnSHgjkWTD1u0W5TNr3RortUb+nW5H6vFLy4HON1HMTyownfIO8womfuLVzRiogZfQY3IPnfdo/P4BegPAKN5FadWE4Jd5rQst4CIhK7taaWOupRk3igNJbRbcXa3wTNPyX2OvSonP/8M+B7gRKm2TYGKfI2NsGHArHHJKrQUOJlucU7HuGHsXnDWyJNFM2Bnz2dMIWjvOEXkeZu82c2AFBztX32hFoiSMxVd9tBmcvmxNuK+94aL1vgN+4NPTLcOcdHpVWwyo+M0YTKI12xt3/HtBelIzrjbATCuqkzUxcenhTwwcSthRRJypTsqZXU44dDpjlVuBIycpAkUPFLShdXvjk1k3Dn8O9vLJvE3yxow/2PE5xo/oeM+CZPw5/1DAzO+Fc3Z+95eopWKjxPr3R4E31J/t1lbTfDecufhkdep5Z6wylsUWYREAH5A2zSlLHXgOOh7OduLCjyeT4yvjiCiRPPIUKbN1HRLADd8oNxBKj0XUiQ2e8jav56anxXDe90cnoL6vk8SlZPvxxSi2s16RqTLL4/gUTIu4k/AMAAA=="
   },
   "Metadata": {
    "aws:cdk:path": "CantoneseWordGameStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "LoadBalancerDNS": {
   "Description": "DNS name of the load balancer",
   "Value": {
    "Fn::GetAtt": [
     "ALBAEE750D2",
     "DNSName"
    ]
   }
  },
  "FrontendECRRepository": {
   "Description": "ECR repository URI for frontend",
   "Value": {
    "Fn::Join": [
     "",
     [
      {
       "Ref": "AWS::AccountId"
      },
      ".dkr.ecr.us-east-1.",
      {
       "Ref": "AWS::URLSuffix"
      },
      "/cantonese-word-game-frontend"
     ]
    ]
   }
  },
  "BackendECRRepository": {
   "Description": "ECR repository URI for backend",
   "Value": {
    "Fn::Join": [
     "",
     [
      {
       "Ref": "AWS::AccountId"
      },
      ".dkr.ecr.us-east-1.",
      {
       "Ref": "AWS::URLSuffix"
      },
      "/cantonese-word-game-backend"
     ]
    ]
   }
  },
  "DatabaseEndpoint": {
   "Description": "RDS PostgreSQL endpoint",
   "Value": {
    "Fn::GetAtt": [
     "PostgreSQLInstanceD9AD3CF0",
     "Endpoint.Address"
    ]
   }
  },
  "SecretsManagerSecret": {
   "Description": "ARN of the secrets manager secret",
   "Value": {
    "Ref": "AppSecretsA1997F2A"
   }
  },
  "CloudWatchDashboard": {
   "Description": "CloudWatch Dashboard URL",
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#dashboards:name=",
      {
       "Ref": "MonitoringDashboard96464763"
      }
     ]
    ]
   }
  },
  "DomainName": {
   "Description": "Full domain name for the application",
   "Value": "app.flumenlucidum.com"
  },
  "HostedZoneId": {
   "Description": "Route 53 Hosted Zone ID",
   "Value": {
    "Ref": "HostedZoneDB99F866"
   }
  },
  "Nameservers": {
   "Description": "Nameservers to configure at domain registrar",
   "Value": {
    "Fn::Join": [
     ", ",
     {
      "Fn::GetAtt": [
       "HostedZoneDB99F866",
       "NameServers"
      ]
     }
    ]
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}